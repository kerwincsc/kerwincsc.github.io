.. 主要存放优化建议

==========
 优化实践
==========

- 在实际生产环境中，:ref:`平均负载<load-average>` 多高时，需要我们重点关注

  在我看来, 当平均负载高于 CPU 数量 **70%** 的时候, 你就应该分析排查负载高的问题了.
  一旦负载过高, 就可能导致进程响应变慢, 进而影响服务的正常功能.

  但 70% 这个数字并不是绝对的, 最推荐的方法, 还是把系统的平均负载监控起来,
  然后根据更多的历史数据, 判断负载的变化趋势.
  
  当发现负载有明显升高趋势时, 比如说负载翻倍了, 你再去做分析和调查.

- **CPU 使用率** 是最直观和最常用的系统性能指标, 要弄清楚
  用户 (%user), Nice(%nice), 系统(%system), 等待 I/O(%iowait),
  中断 (%irq) 以及软中断 (%softirq) 这几种不同 CPU 的使用率.比如说:

  - **用户 CPU 和 Nice CPU 高**

    说明用户态进程占用了较多的 CPU, 所以应该着重排查进程的性能问题.

  - **系统 CPU 高**

    说明内核态占用了较多的 CPU, 所以应该着重排查内核线程或者系统调用的性能问题.

  - **I/O 等待 CPU 高**

    说明等待 I/O 的时间比较长, 所以应该着重排查系统存储是不是出现了 I/O 问题.

  - **软中断和硬中断高**

    说明软中断或硬中断的处理程序占用了较多的 CPU,
    所以应该着重排查内核中的中断服务程序.

  碰到 CPU 使用率升高的问题, 可以借助 top, pidstat 等工具,
  确认引发 CPU 性能问题的来源;
  再使用 perf 等工具, 排查出引起性能问题的具体函数;

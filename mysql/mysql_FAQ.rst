====================
 Mysql 常见运维问题
====================

- mysql 异常重启

  - 原因及解决方法

    1. 长连接累积, 可能导致内存占用过大, 被系统强行杀掉 (OOM), 从而表现为异常重启.

       - 定期断开长连接

	 使用一段时间, 或者程序里面判断执行过一个占用内存的大查询后, 断开连接,
	 之后要查询再重新连接;

       - 执行 ``mysql_reset_connection``

	 当 MySQL>=5.7, 在每次执行一个比较大的操作后.

	 此过程不需要重新做权限验证, 但是会将连接恢复到刚刚创建完时的状态

- 不要使用 **查询缓存**

  1. 查询缓存失效非常频繁

     只要有对一个表的更新, 这个表上所有的查询缓存都会被清空.

     对于更新压力大的数据库来说, **查询缓存** 的命中率非常低.

     只有当你的业务就一张静态表, 很长时间才会更新一次, 才适合用查询缓存

     Mysql8 中已经将查询缓存删掉了, 即没有这个功能了.

     - 关闭查询缓存

       将 ``query_cache_type`` 设为 **DEMAND**, 默认情况下, SQL 将不会使用查询缓存,
       而你确定要使用查询缓存的语句, 可以用 **SQL_CACHE** 显式指定

       .. code-block:: shell

	  mysql> select SQL_CACHE * from T where ID=10;x
       
